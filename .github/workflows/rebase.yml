name: Rebase on Upstream

on:
  workflow_dispatch:       # Allows manual trigger
  schedule:
    - cron: '0 0 * * *'    # Scheduled to run daily at midnight UTC

jobs:
  rebase:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        ref: main            # Replace with your default branch if different
        fetch-depth: 0       # Fetch full git history for rebase
        token: ${{ secrets.GH_PAT }}

    - name: Set up Git user
      run: |
        git config user.name 'github-actions[bot]'
        git config user.email 'github-actions[bot]@users.noreply.github.com'

    - name: Add upstream remote
      run: |
        git remote add upstream https://github.com/anthropics/claude-code.git
        git fetch upstream

    - name: Rebase on upstream/main
      run: |
        git rebase upstream/main

    - name: Push changes
      run: |
        git push origin main --force-with-lease
